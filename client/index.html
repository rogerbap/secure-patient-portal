<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Patient Portal - Healthcare Security Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-text: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .portal-header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .portal-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .portal-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .card-header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .login-section {
            padding: 40px;
        }

        .status-section {
            background: var(--light-bg);
            padding: 30px;
            border-top: 1px solid #dee2e6;
        }

        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #1e3d72;
            transform: translateY(-1px);
        }

        .demo-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #2196f3;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .badge-custom {
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .risk-meter {
            width: 100%;
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        .risk-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1s ease, background-color 0.8s ease;
        }

        .risk-low { 
            background: linear-gradient(90deg, #28a745, #20c997); 
        }

        .risk-medium { 
            background: linear-gradient(90deg, #ffc107, #fd7e14); 
        }

        .risk-high { 
            background: linear-gradient(90deg, #dc3545, #e91e63); 
        }

        .api-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1050;
            min-width: 200px;
        }

        .server-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.95);
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.85rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .tech-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container { padding: 15px; }
            .portal-header h1 { font-size: 2rem; }
            .login-section, .status-section { padding: 25px; }
            .api-status { position: relative; top: auto; right: auto; margin-bottom: 20px; }
            .server-info { position: relative; bottom: auto; left: auto; margin-top: 20px; }
        }
    </style>
</head>
<body>
    <!-- API Status Indicator -->
    <div class="api-status" id="apiStatus">
        <div class="d-flex align-items-center">
            <div class="spinner-border spinner-border-sm text-primary me-2" id="statusSpinner"></div>
            <span id="statusText">Connecting to API...</span>
        </div>
    </div>

    <!-- Server Information -->
    <div class="server-info">
        <strong>System Status:</strong> 
        <span class="text-success">Frontend Active</span> | 
        <span class="text-primary" id="backendStatus">Backend Checking...</span>
    </div>

    <div class="main-container">
        <!-- Header -->
        <header class="portal-header fade-in">
            <h1><i class="fas fa-shield-alt"></i> Secure Patient Portal</h1>
            <p class="lead">Enterprise Healthcare Security Platform</p>
            <small class="text-light">
                <i class="fas fa-lock"></i> Production-ready authentication system with advanced threat detection
            </small>
        </header>

        <!-- Main Application -->
        <main class="portal-card fade-in">
            <div class="card-header">
                <h3><i class="fas fa-user-lock"></i> Secure Authentication System</h3>
                <p class="mb-0">Advanced security monitoring with real-time risk assessment</p>
            </div>

            <div class="row g-0">
                <!-- Login Form -->
                <div class="col-md-6">
                    <section class="login-section">
                        <!-- Mode Toggle -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <h4>Portal Access</h4>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="demoMode" checked>
                                    <label class="form-check-label" for="demoMode">
                                        <small>Demo Mode</small>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Demo Account Selector (only in demo mode) -->
                        <div class="demo-info" id="demoSection">
                            <h6><i class="fas fa-vial"></i> Demo Accounts Available</h6>
                            <div class="row">
                                <div class="col-6">
                                    <button class="btn btn-outline-primary btn-sm w-100 mb-2 active" 
                                            onclick="selectDemoUser('patient', this)">
                                        <i class="fas fa-user"></i> Patient
                                    </button>
                                    <button class="btn btn-outline-success btn-sm w-100" 
                                            onclick="selectDemoUser('provider', this)">
                                        <i class="fas fa-user-md"></i> Provider
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-outline-warning btn-sm w-100 mb-2" 
                                            onclick="selectDemoUser('admin', this)">
                                        <i class="fas fa-user-shield"></i> Admin
                                    </button>
                                    <button class="btn btn-outline-danger btn-sm w-100" 
                                            onclick="selectDemoUser('suspicious', this)">
                                        <i class="fas fa-exclamation-triangle"></i> High Risk
                                    </button>
                                </div>
                            </div>
                            <small class="text-muted">
                                <strong>Demo Password:</strong> SecurePass123!
                            </small>
                        </div>

                        <!-- Production Login Instructions (when demo mode off) -->
                        <div class="alert alert-info d-none" id="productionInfo">
                            <h6><i class="fas fa-info-circle"></i> Production Mode</h6>
                            <p class="mb-0">Enter your registered healthcare portal credentials. 
                            Contact IT support for account creation or password reset.</p>
                        </div>

                        <!-- Login Form -->
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="email" class="form-label">
                                    <i class="fas fa-envelope"></i> Email Address
                                </label>
                                <input type="email" 
                                       class="form-control" 
                                       id="email" 
                                       value="patient@demo.com" 
                                       required 
                                       autocomplete="email"
                                       placeholder="Enter your email address">
                            </div>
                            
                            <div class="mb-3">
                                <label for="password" class="form-label">
                                    <i class="fas fa-lock"></i> Password
                                </label>
                                <input type="password" 
                                       class="form-control" 
                                       id="password" 
                                       value="SecurePass123!" 
                                       required 
                                       autocomplete="current-password"
                                       placeholder="Enter your password">
                            </div>
                            
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="rememberMe">
                                <label class="form-check-label" for="rememberMe">
                                    Keep me signed in for 30 days
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100" id="loginBtn">
                                <i class="fas fa-sign-in-alt"></i> Secure Login
                            </button>
                        </form>

                        <!-- Login Result -->
                        <div id="loginResult" class="mt-3"></div>

                        <!-- Additional Options -->
                        <div class="mt-4 pt-3 border-top">
                            <div class="row">
                                <div class="col-6">
                                    <a href="#" class="text-decoration-none">
                                        <i class="fas fa-key"></i> Forgot Password?
                                    </a>
                                </div>
                                <div class="col-6 text-end">
                                    <a href="#" class="text-decoration-none">
                                        <i class="fas fa-user-plus"></i> Register Account
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Demo Tools (only in demo mode) -->
                        <div class="mt-3" id="demoTools">
                            <small class="text-muted d-block mb-2">Demo Tools:</small>
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="btn btn-outline-secondary btn-sm" onclick="checkSystemHealth()">
                                    <i class="fas fa-heartbeat"></i> System Health
                                </button>
                                <button class="btn btn-outline-info btn-sm" onclick="viewTechnicalDocs()">
                                    <i class="fas fa-book"></i> Technical Docs
                                </button>
                                <button class="btn btn-outline-warning btn-sm" onclick="simulateSecurityThreat()">
                                    <i class="fas fa-bug"></i> Security Test
                                </button>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Security Monitoring -->
                <div class="col-md-6">
                    <section class="status-section">
                        <h5><i class="fas fa-radar"></i> Security Monitoring</h5>
                        
                        <!-- Threat Level Display -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6>Threat Level Assessment</h6>
                                <span class="badge badge-custom bg-success" id="threatBadge">SECURE</span>
                            </div>
                            <div class="risk-meter">
                                <div class="risk-fill risk-low" id="riskMeter" style="width: 25%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span id="riskLevel">Low Risk</span>
                                <span id="riskScore">25/100</span>
                            </div>
                        </div>

                        <!-- Security Factors -->
                        <div class="status-item">
                            <span><i class="fas fa-globe-americas"></i> Geographic Location</span>
                            <span class="badge badge-custom bg-success" id="locationStatus">Trusted</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-fingerprint"></i> Device Identity</span>
                            <span class="badge badge-custom bg-success" id="deviceStatus">Verified</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-clock"></i> Access Pattern</span>
                            <span class="badge badge-custom bg-success" id="timingStatus">Normal</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-shipping-fast"></i> Login Velocity</span>
                            <span class="badge badge-custom bg-success" id="velocityStatus">Standard</span>
                        </div>
                        <div class="status-item">
                            <span><i class="fas fa-network-wired"></i> Network Reputation</span>
                            <span class="badge badge-custom bg-success" id="networkStatus">Clean</span>
                        </div>

                        <!-- Security Actions -->
                        <div class="mt-4">
                            <h6><i class="fas fa-cogs"></i> Security Response</h6>
                            <div id="securityActions">
                                <div class="alert alert-success">
                                    <i class="fas fa-check-circle"></i> 
                                    <strong>All Clear</strong><br>
                                    No security threats detected. Standard access granted.
                                </div>
                            </div>
                        </div>

                        <!-- System Info -->
                        <div class="mt-3 p-3 bg-light rounded">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> 
                                <strong>Security Engine:</strong> Advanced ML-based threat detection<br>
                                <i class="fas fa-clock"></i> 
                                <strong>Last Scan:</strong> <span id="lastScanTime">Just now</span><br>
                                <i class="fas fa-shield-alt"></i> 
                                <strong>Protection Level:</strong> Enterprise Grade
                            </small>
                        </div>
                    </section>
                </div>
            </div>
        </main>

        <!-- Technology Showcase -->
        <section class="feature-grid">
            <div class="feature-card">
                <i class="fas fa-key"></i>
                <h5>JWT Authentication</h5>
                <p>Industry-standard token-based authentication with automatic refresh and secure session management.</p>
                <small class="text-success"><i class="fas fa-check"></i> Production Ready</small>
            </div>
            
            <div class="feature-card">
                <i class="fas fa-brain"></i>
                <h5>AI Risk Engine</h5>
                <p>Machine learning-powered threat detection analyzing behavioral patterns and anomaly detection.</p>
                <small class="text-success"><i class="fas fa-check"></i> Active Monitoring</small>
            </div>
            
            <div class="feature-card">
                <i class="fas fa-users-cog"></i>
                <h5>Access Control</h5>
                <p>Granular role-based permissions with dynamic policy enforcement and privilege escalation controls.</p>
                <small class="text-success"><i class="fas fa-check"></i> RBAC Enabled</small>
            </div>
        </section>

        <!-- Technical Stack -->
        <section class="tech-stack">
            <div class="tech-item">
                <i class="fab fa-node-js text-success"></i>
                <strong>Backend</strong>
                <small>Node.js + Express</small>
            </div>
            
            <div class="tech-item">
                <i class="fas fa-database text-primary"></i>
                <strong>Database</strong>
                <small>PostgreSQL/SQLite</small>
            </div>
            
            <div class="tech-item">
                <i class="fas fa-shield-alt text-danger"></i>
                <strong>Security</strong>
                <small>Multi-layer Protection</small>
            </div>
            
            <div class="tech-item">
                <i class="fas fa-code text-info"></i>
                <strong>Frontend</strong>
                <small>Modern Web Standards</small>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Application State
        let isDemoMode = true;
        let currentUser = 'patient';
        let apiConnected = false;
        const API_BASE = 'http://localhost:3000';

        // Demo user configurations
        const demoUsers = {
            patient: {
                email: 'patient@demo.com',
                riskScore: 25,
                profile: 'Standard patient with normal access patterns'
            },
            provider: {
                email: 'doctor@demo.com', 
                riskScore: 15,
                profile: 'Healthcare provider with trusted network access'
            },
            admin: {
                email: 'admin@demo.com',
                riskScore: 35, 
                profile: 'System administrator with elevated privileges'
            },
            suspicious: {
                email: 'suspicious@demo.com',
                riskScore: 85,
                profile: 'High-risk user with multiple security flags'
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏥 Secure Patient Portal - Initializing...');
            initializeApp();
        });

        function initializeApp() {
            checkApiConnection();
            setupEventListeners();
            updateSecurityDisplay();
            startSecurityMonitoring();
            
            // Add loading animation
            document.querySelector('.main-container').classList.add('fade-in');
            
            console.log('✅ Application initialized');
        }

        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Demo mode toggle
            document.getElementById('demoMode').addEventListener('change', toggleDemoMode);
            
            // Update last scan time
            updateLastScanTime();
            setInterval(updateLastScanTime, 5000);
        }

        async function checkApiConnection() {
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                if (data.status === 'healthy') {
                    apiConnected = true;
                    updateApiStatus('Connected', 'success');
                    document.getElementById('backendStatus').innerHTML = '<span class="text-success">Backend Online</span>';
                    console.log('✅ API Connected:', data);
                } else {
                    throw new Error('API unhealthy');
                }
            } catch (error) {
                apiConnected = false;
                updateApiStatus('Offline', 'danger');
                document.getElementById('backendStatus').innerHTML = '<span class="text-danger">Backend Offline</span>';
                console.warn('⚠️ API Connection failed - Demo mode only');
            }
        }

        function updateApiStatus(status, type) {
            const statusEl = document.getElementById('apiStatus');
            const textEl = document.getElementById('statusText');
            const spinnerEl = document.getElementById('statusSpinner');
            
            textEl.textContent = `API ${status}`;
            spinnerEl.style.display = type === 'success' ? 'none' : 'inline-block';
            statusEl.className = `api-status alert alert-${type}`;
            
            if (type === 'success') {
                setTimeout(() => statusEl.style.opacity = '0.8', 2000);
            }
        }

        function toggleDemoMode() {
            isDemoMode = document.getElementById('demoMode').checked;
            
            const demoSection = document.getElementById('demoSection');
            const demoTools = document.getElementById('demoTools');
            const productionInfo = document.getElementById('productionInfo');
            
            if (isDemoMode) {
                demoSection.classList.remove('d-none');
                demoTools.classList.remove('d-none');
                productionInfo.classList.add('d-none');
                
                // Reset to demo defaults
                selectDemoUser('patient');
            } else {
                demoSection.classList.add('d-none');
                demoTools.classList.add('d-none');
                productionInfo.classList.remove('d-none');
                
                // Clear form for production use
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
            }
        }

        // Global functions for onclick handlers
        window.selectDemoUser = function(userType, buttonEl) {
            if (!isDemoMode) return;
            
            currentUser = userType;
            const user = demoUsers[userType];
            
            // Update form
            document.getElementById('email').value = user.email;
            document.getElementById('password').value = 'SecurePass123!';
            
            // Update button states
            document.querySelectorAll('.demo-info button').forEach(btn => 
                btn.classList.remove('active'));
            if (buttonEl) buttonEl.classList.add('active');
            
            // Update risk display
            updateRiskDisplay(user.riskScore);
            
            console.log(`👤 Selected ${userType}: ${user.profile}`);
        };

        window.checkSystemHealth = async function() {
            try {
                if (apiConnected) {
                    const response = await fetch(`${API_BASE}/api/health`);
                    const data = await response.json();
                    
                    alert(`System Health Report:
                    
✅ API Status: ${data.status}
📊 Version: ${data.version}
🌍 Environment: ${data.environment}
⏱️ Uptime: ${Math.round(data.uptime)}s
🔧 Features: Authentication, Risk Assessment, Audit Logging

All systems operational.`);
                } else {
                    alert(`System Health Report:
                    
✅ Frontend: Online
❌ Backend API: Offline (Demo Mode)
🔧 Database: Not Connected
⚡ Security Engine: Simulated

Running in demonstration mode.`);
                }
            } catch (error) {
                alert('Health check failed. System may be experiencing issues.');
            }
        };

        window.viewTechnicalDocs = function() {
            const docsContent = `
Technical Documentation:

🏗️ ARCHITECTURE:
• Frontend: Modern HTML5, CSS3, JavaScript ES6+
• Backend: Node.js + Express.js
• Database: SQLite (dev) / PostgreSQL (prod)
• Security: JWT, bcrypt, rate limiting, CORS

🔐 SECURITY FEATURES:
• Multi-factor risk assessment
• Real-time threat detection
• Geographic anomaly detection
• Device fingerprinting
• Behavioral analytics
• Audit logging (HIPAA compliant)

📊 RISK ASSESSMENT:
• Location Analysis (0-40 points)
• Device Identity (0-30 points)
• Access Patterns (0-20 points)
• Network Reputation (0-10 points)

🚀 DEPLOYMENT:
• Docker containers supported
• Cloud-ready (AWS, Azure, GCP)
• Horizontal scaling capability
• Load balancer compatible

For full documentation, check the GitHub repository.
            `;
            
            alert(docsContent);
        };

        window.simulateSecurityThreat = function() {
            // Temporarily switch to high-risk mode
            const originalUser = currentUser;
            
            selectDemoUser('suspicious');
            updateRiskDisplay(85);
            
            alert(`🚨 Security Threat Simulation Activated!

The system has detected:
• Suspicious login from unknown location
• New device accessing sensitive data
• Unusual access patterns detected
• Multiple rapid authentication attempts

Response Actions:
• Enhanced monitoring enabled
• Security team notified
• Additional verification required
• Session privileges restricted

This demonstrates how the system responds to real security threats.`);
            
            // Reset after 10 seconds
            setTimeout(() => {
                selectDemoUser(originalUser);
                console.log('🔄 Security simulation reset');
            }, 10000);
        };

        function selectDemoUser(userType, buttonEl) {
            // This is the internal version - just call the global one
            window.selectDemoUser(userType, buttonEl);
        }

        function updateRiskDisplay(riskScore) {
            const riskMeter = document.getElementById('riskMeter');
            const riskLevel = document.getElementById('riskLevel');
            const riskScoreEl = document.getElementById('riskScore');
            const threatBadge = document.getElementById('threatBadge');
            
            // Update meter
            riskMeter.style.width = riskScore + '%';
            riskScoreEl.textContent = riskScore + '/100';
            
            // Update styling based on risk level
            riskMeter.className = 'risk-fill';
            
            if (riskScore < 30) {
                riskMeter.classList.add('risk-low');
                riskLevel.textContent = 'Low Risk';
                threatBadge.textContent = 'SECURE';
                threatBadge.className = 'badge badge-custom bg-success';
                updateSecurityBadges('success');
            } else if (riskScore < 60) {
                riskMeter.classList.add('risk-medium');
                riskLevel.textContent = 'Medium Risk';
                threatBadge.textContent = 'CAUTION';
                threatBadge.className = 'badge badge-custom bg-warning';
                updateSecurityBadges('warning');
            } else {
                riskMeter.classList.add('risk-high');
                riskLevel.textContent = 'High Risk';
                threatBadge.textContent = 'THREAT';
                threatBadge.className = 'badge badge-custom bg-danger';
                updateSecurityBadges('danger');
            }
        }

        function updateSecurityBadges(level) {
            const badges = ['locationStatus', 'deviceStatus', 'timingStatus', 'velocityStatus', 'networkStatus'];
            const configs = {
                success: { class: 'bg-success', texts: ['Trusted', 'Verified', 'Normal', 'Standard', 'Clean'] },
                warning: { class: 'bg-warning', texts: ['New Location', 'Verified', 'Normal', 'Standard', 'Clean'] },
                danger: { class: 'bg-danger', texts: ['Unknown', 'Suspicious', 'Anomalous', 'High', 'Flagged'] }
            };
            
            const config = configs[level];
            badges.forEach((id, index) => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = config.texts[index];
                    el.className = `badge badge-custom ${config.class}`;
                }
            });
        }

        function updateSecurityDisplay() {
            if (isDemoMode) {
                updateRiskDisplay(demoUsers[currentUser].riskScore);
            } else {
                updateRiskDisplay(25); // Default safe level
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const resultDiv = document.getElementById('loginResult');
            
            // Validation
            if (!email || !password) {
                showResult('Please enter both email and password', 'danger');
                return;
            }
            
            // Loading state
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Authenticating...';
            loginBtn.disabled = true;
            
            try {
                if (isDemoMode) {
                    // Demo mode authentication
                    await simulateLogin(email, password);
                } else {
                    // Production authentication
                    await productionLogin(email, password);
                }
            } catch (error) {
                console.error('Login error:', error);
                showResult('Authentication failed. Please try again.', 'danger');
            } finally {
                // Reset button
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Secure Login';
                loginBtn.disabled = false;
            }
        }

        async function simulateLogin(email, password) {
            // Simulate authentication delay
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            const user = Object.values(demoUsers).find(u => u.email === email);
            
            if (user && password === 'SecurePass123!') {
                const userType = Object.keys(demoUsers).find(key => demoUsers[key] === user);
                showResult(`✅ Welcome! Authenticated as ${userType}. Risk Level: ${user.riskScore}/100`, 'success');
                
                // Update security actions
                updateSecurityActions(user.riskScore);
                
                console.log(`✅ Demo login successful: ${userType}`);
            } else {
                showResult('❌ Invalid credentials for demo account', 'danger');
            }
        }

        async function productionLogin(email, password) {
            if (!apiConnected) {
                throw new Error('API connection required for production authentication');
            }
            
            const response = await fetch(`${API_BASE}/api/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (data.success) {
                showResult(`✅ Welcome ${data.user.name}! Risk Score: ${data.riskAssessment.riskScore}/100`, 'success');
                updateRiskDisplay(data.riskAssessment.riskScore);
                updateSecurityActions(data.riskAssessment.riskScore);
                
                // Store session
                sessionStorage.setItem('authToken', data.accessToken);
                sessionStorage.setItem('userInfo', JSON.stringify(data.user));
                
                console.log('✅ Production login successful');
            } else {
                showResult(`❌ ${data.message}`, 'danger');
            }
        }

        function updateSecurityActions(riskScore) {
            const actionsDiv = document.getElementById('securityActions');
            let content;
            
            if (riskScore >= 70) {
                content = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> 
                        <strong>High Threat Detected</strong><br>
                        Additional verification required. Security team notified.
                    </div>
                `;
            } else if (riskScore >= 40) {
                content = `
                    <div class="alert alert-warning">
                        <i class="fas fa-shield-alt"></i> 
                        <strong>Enhanced Monitoring</strong><br>
                        Elevated security protocols activated for this session.
                    </div>
                `;
            } else {
                content = `
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> 
                        <strong>All Clear</strong><br>
                        No security threats detected. Standard access granted.
                    </div>
                `;
            }
            
            actionsDiv.innerHTML = content;
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('loginResult');
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'warning' ? 'alert-warning' : 'alert-danger';
            
            resultDiv.innerHTML = `<div class="alert ${alertClass} fade-in">${message}</div>`;
            
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 6000);
        }

        function startSecurityMonitoring() {
            // Simulate real-time security monitoring
            setInterval(() => {
                updateLastScanTime();
                
                // Random security events simulation
                if (Math.random() < 0.1) { // 10% chance every interval
                    console.log('🔍 Security scan completed - No threats detected');
                }
            }, 10000);
        }

        function updateLastScanTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            document.getElementById('lastScanTime').textContent = timeStr;
        }

        // Remove duplicate function definitions and use global ones
        const checkSystemHealth = window.checkSystemHealth;
        const viewTechnicalDocs = window.viewTechnicalDocs;
        const simulateSecurityThreat = window.simulateSecurityThreat;

        // Periodic API health checks
        setInterval(checkApiConnection, 30000);

        // Initialize demo user selection
        if (isDemoMode) {
            selectDemoUser('patient');
        }

        // Console welcome message
        setTimeout(() => {
            console.log(`
🏥 ===============================================
   SECURE PATIENT PORTAL - FRONTEND LOADED
===============================================
🎯 Purpose: Healthcare Security Demonstration
🔧 Mode: ${isDemoMode ? 'Demo' : 'Production'}
🌐 Frontend: http://localhost:8080
🔌 Backend: ${apiConnected ? 'Connected' : 'Offline'}

📋 Features Demonstrated:
✅ JWT Authentication & Session Management
✅ Advanced Risk Assessment Engine
✅ Role-based Access Control (RBAC)
✅ Real-time Security Monitoring
✅ Behavioral Analytics & Threat Detection
✅ HIPAA-Compliant Audit Logging
✅ Geographic & Device Fingerprinting
✅ Rate Limiting & DDoS Protection

🎮 Demo Instructions:
1. Toggle Demo Mode on/off for different experiences
2. Try different user types to see risk variations
3. Use Demo Tools to explore security features
4. Monitor real-time security assessment changes

💼 Portfolio Highlights:
• Production-ready authentication system
• Enterprise-grade security implementation
• Healthcare industry best practices
• Full-stack development expertise
• Modern web technologies & standards

===============================================`);
        }, 2000);

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Application error:', event.error);
        });

        // Performance monitoring
        window.addEventListener('load', function() {
            const loadTime = performance.now();
            console.log(`⚡ Application loaded in ${Math.round(loadTime)}ms`);
        });
    </script>
</body>
</html>